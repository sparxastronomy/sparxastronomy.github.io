---
---
<script is:inline>
function attachEvent(selector, event, fn) {
	const matches = document.querySelectorAll(selector);
	if (matches && matches.length) {
		matches.forEach((elem) => {
			elem.removeEventListener(event, elem._attachedFn, false);
			elem._attachedFn = () => fn(elem);
			elem.addEventListener(event, elem._attachedFn, false);
		});
	}
}

// Hamburger and menu logic
function menuCheck() {
	const elem = document.querySelector('[data-aw-toggle-menu]');
	const nav = document.getElementById('header-nav-mobile');
	if (elem && nav) {
		elem.classList.remove('opened');
		document.body.classList.remove('overflow-hidden');
		nav.classList.add('hidden');
		// Reset nav links animation
		nav.querySelectorAll('.navlink-item').forEach((li) => {
			li.classList.remove('show');
		});
	}
}

// Theme logic
const themeCheck = () => {
	if (
		localStorage.theme === 'dark' ||
		(!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
	) {
		document.documentElement.classList.add('dark');
	} else {
		document.documentElement.classList.remove('dark');
	}
};

function setupHeaderEvents() {
	attachEvent('[data-aw-toggle-menu]', 'click', function (elem) {
    const nav = document.getElementById('header-nav-mobile');
    const opened = elem.classList.toggle('opened');
    document.body.classList.toggle('overflow-hidden', opened);

    if (nav) {
      if (opened) {
        nav.classList.remove('hidden');
        // Animate nav links in
        const items = nav.querySelectorAll('.navlink-item');
        items.forEach((li, i) => {
          setTimeout(() => {
            li.classList.add('show');
          }, i * 60);
        });
      } else {
        // Animate nav links out
        const items = nav.querySelectorAll('.navlink-item');
        items.forEach((li, i) => {
          setTimeout(() => {
            li.classList.remove('show');
          }, i * 40);
        });
        setTimeout(() => nav.classList.add('hidden'), 300);
      }
    }
  });
	attachEvent('[data-aw-toggle-theme]', 'click', function () {
		document.documentElement.classList.toggle('dark');
		localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
	});
}

window.addEventListener('DOMContentLoaded', () => {
	themeCheck();
	setupHeaderEvents();
});

document.addEventListener('astro:after-swap', () => {
	themeCheck();
	setupHeaderEvents();
	menuCheck();
});
</script>

<!-- Init Lenis -->
<script>
	// Lenis configuration
	import Lenis from "lenis";
	function easingCustom(t) {
		return Math.min(1, 1.001 - Math.pow(2, -10 * t));
	}

	const lenis = new Lenis({smoothWheel: true, easing: easingCustom});

	//get scroll value
	lenis.on("scroll", (e) => {
		console.log(e);
	});

	function raf(time) {
		lenis.raf(time);
		requestAnimationFrame(raf);
	}

	requestAnimationFrame(raf);
</script>